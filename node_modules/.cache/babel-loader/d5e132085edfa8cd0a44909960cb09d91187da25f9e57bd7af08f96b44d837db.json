{"ast":null,"code":"import _objectSpread from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _toConsumableArray from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _regeneratorRuntime from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _classCallCheck from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React,{Component}from\"react\";import{getMovies,deleteMovie}from\"../services/movieService\";import{getGenres}from\"../services/genreService\";import{toast}from\"react-toastify\";import Pagination from\"./common/pagination\";import{paginate}from\"../utils/paginate\";import ListGroup from\"./common/listGroup\";import MoviesTable from\"./moviesTable\";import{Link}from\"react-router-dom\";import _ from\"lodash\";import SearchBox from\"./searchBox\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Movies=/*#__PURE__*/function(_Component){_inherits(Movies,_Component);var _super=_createSuper(Movies);function Movies(){var _this;_classCallCheck(this,Movies);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={movies:[],genres:[],searchQuery:\"\",selectedGenre:null,pageSize:4,currentPage:1,sortColumn:{path:\"title\",order:\"asc\"}};_this.handleDelete=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(m){var originalMovies,movies;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:originalMovies=_this.state.movies;movies=originalMovies.filter(function(film){return film!==m;});_this.setState({movies:movies});_context.prev=3;_context.next=6;return deleteMovie(m._id);case 6:_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](3);if(_context.t0.response&&_context.t0.response.status===404)// I get 400 instead\ntoast.error(\"This movie has already been deleted.\");// alert(\"This movie has already been deleted.\");\n_this.setState({movies:originalMovies});case 12:case\"end\":return _context.stop();}}},_callee,null,[[3,8]]);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleLike=function(m){var movies=_toConsumableArray(_this.state.movies);var index=movies.indexOf(m);movies[index]=_objectSpread({},movies[index]);movies[index].liked=!movies[index].liked;_this.setState({movies:movies});};_this.handlePageChange=function(p){_this.setState({currentPage:p});};_this.handleGenreSelect=function(genre){_this.setState({selectedGenre:genre,currentPage:1,searchQuery:\"\"});};_this.handleSort=function(sortColumn){_this.setState({sortColumn:sortColumn});};_this.handleSearch=function(query){// let searched = this.state.search;\n_this.setState({searchQuery:query,selectedGenre:null,currentPage:1});};_this.getPagedData=function(){var _this$state=_this.state,pageSize=_this$state.pageSize,currentPage=_this$state.currentPage,allMovies=_this$state.movies,selectedGenre=_this$state.selectedGenre,sortColumn=_this$state.sortColumn,searchQuery=_this$state.searchQuery;var genreFiltered=selectedGenre&&selectedGenre._id?allMovies.filter(function(m){return m.genre._id===selectedGenre._id;}):null;var searchFiltered=searchQuery?allMovies.filter(function(movie){return movie.title.toUpperCase().includes(searchQuery.toUpperCase());}):null;var filtered=genreFiltered||searchFiltered||allMovies;// const filtered =\n//   selectedGenre && selectedGenre._id\n//     ? allMovies.filter((m) => m.genre._id === selectedGenre._id)\n//     : allMovies;\nvar sorted=_.orderBy(filtered,[sortColumn.path],[sortColumn.order]);var movies=paginate(sorted,currentPage,pageSize);return{totalCount:filtered.length,data:movies};};return _this;}_createClass(Movies,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var _yield$getGenres,data,genres,_yield$getMovies,movies;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getGenres();case 2:_yield$getGenres=_context2.sent;data=_yield$getGenres.data;genres=[{_id:\"\",name:\"All Genres\"}].concat(_toConsumableArray(data));_context2.next=7;return getMovies();case 7:_yield$getMovies=_context2.sent;movies=_yield$getMovies.data;this.setState({movies:movies,genres:genres});case 10:case\"end\":return _context2.stop();}}},_callee2,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var count=this.state.movies.length;var _this$state2=this.state,pageSize=_this$state2.pageSize,currentPage=_this$state2.currentPage,selectedGenre=_this$state2.selectedGenre,sortColumn=_this$state2.sortColumn,searchQuery=_this$state2.searchQuery;var user=this.props.user;// if (count === 0) return <p>There are no movies to show</p>;\nvar _this$getPagedData=this.getPagedData(),totalCount=_this$getPagedData.totalCount,movies=_this$getPagedData.data;return/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-2\",children:/*#__PURE__*/_jsx(ListGroup,{items:this.state.genres,selectedItem:selectedGenre,onItemSelect:this.handleGenreSelect})}),/*#__PURE__*/_jsxs(\"div\",{className:\"col\",children:[user&&/*#__PURE__*/_jsx(Link,{to:\"/movies/new\",className:\"btn btn-primary\",style:{marginBottom:20},children:\"New Movie\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Showing \",totalCount,\" movies in the databse\"]}),/*#__PURE__*/_jsx(SearchBox,{value:searchQuery,onSearch:this.handleSearch}),/*#__PURE__*/_jsx(MoviesTable,{movies:movies,sortColumn:sortColumn,onLike:this.handleLike,onDelete:this.handleDelete,onSort:this.handleSort}),/*#__PURE__*/_jsx(Pagination,{itemsCount:totalCount,pageSize:pageSize,currentPage:currentPage,onPageChange:this.handlePageChange})]})]});}}]);return Movies;}(Component);export default Movies;","map":{"version":3,"names":["React","Component","getMovies","deleteMovie","getGenres","toast","Pagination","paginate","ListGroup","MoviesTable","Link","_","SearchBox","Movies","state","movies","genres","searchQuery","selectedGenre","pageSize","currentPage","sortColumn","path","order","handleDelete","m","originalMovies","filter","film","setState","_id","response","status","error","handleLike","index","indexOf","liked","handlePageChange","p","handleGenreSelect","genre","handleSort","handleSearch","query","getPagedData","allMovies","genreFiltered","searchFiltered","movie","title","toUpperCase","includes","filtered","sorted","orderBy","totalCount","length","data","name","count","user","props","marginBottom"],"sources":["/Users/hooman/Desktop/Hh Coding/_iCoding/Demo/vidly/src/components/movies.jsx"],"sourcesContent":["import React, { Component } from \"react\";\nimport { getMovies, deleteMovie } from \"../services/movieService\";\nimport { getGenres } from \"../services/genreService\";\nimport { toast } from \"react-toastify\";\nimport Pagination from \"./common/pagination\";\nimport { paginate } from \"../utils/paginate\";\nimport ListGroup from \"./common/listGroup\";\nimport MoviesTable from \"./moviesTable\";\nimport { Link } from \"react-router-dom\";\nimport _ from \"lodash\";\nimport SearchBox from \"./searchBox\";\n\nclass Movies extends Component {\n  state = {\n    movies: [],\n    genres: [],\n    searchQuery: \"\",\n    selectedGenre: null,\n    pageSize: 4,\n    currentPage: 1,\n    sortColumn: { path: \"title\", order: \"asc\" },\n  };\n  async componentDidMount() {\n    const { data } = await getGenres();\n    const genres = [{ _id: \"\", name: \"All Genres\" }, ...data];\n\n    const { data: movies } = await getMovies();\n\n    this.setState({ movies, genres });\n  }\n  handleDelete = async (m) => {\n    const originalMovies = this.state.movies;\n\n    const movies = originalMovies.filter((film) => film !== m);\n    this.setState({ movies: movies });\n\n    try {\n      // await http.delete(config.apiMoviesEndpoint + \"/\" + m._id);\n      await deleteMovie(m._id);\n    } catch (ex) {\n      if (ex.response && ex.response.status === 404)\n        // I get 400 instead\n        toast.error(\"This movie has already been deleted.\");\n      // alert(\"This movie has already been deleted.\");\n\n      this.setState({ movies: originalMovies });\n    }\n  };\n  handleLike = (m) => {\n    const movies = [...this.state.movies];\n    const index = movies.indexOf(m);\n    movies[index] = { ...movies[index] };\n    movies[index].liked = !movies[index].liked;\n    this.setState({ movies });\n  };\n  handlePageChange = (p) => {\n    this.setState({ currentPage: p });\n  };\n  handleGenreSelect = (genre) => {\n    this.setState({ selectedGenre: genre, currentPage: 1, searchQuery: \"\" });\n  };\n  handleSort = (sortColumn) => {\n    this.setState({ sortColumn });\n  };\n\n  handleSearch = (query) => {\n    // let searched = this.state.search;\n    this.setState({\n      searchQuery: query,\n      selectedGenre: null,\n      currentPage: 1,\n    });\n  };\n\n  getPagedData = () => {\n    const {\n      pageSize,\n      currentPage,\n      movies: allMovies,\n      selectedGenre,\n      sortColumn,\n      searchQuery,\n    } = this.state;\n\n    const genreFiltered =\n      selectedGenre && selectedGenre._id\n        ? allMovies.filter((m) => m.genre._id === selectedGenre._id)\n        : null;\n\n    const searchFiltered = searchQuery\n      ? allMovies.filter((movie) =>\n          movie.title.toUpperCase().includes(searchQuery.toUpperCase())\n        )\n      : null;\n\n    const filtered = genreFiltered || searchFiltered || allMovies;\n\n    // const filtered =\n    //   selectedGenre && selectedGenre._id\n    //     ? allMovies.filter((m) => m.genre._id === selectedGenre._id)\n    //     : allMovies;\n\n    const sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);\n\n    const movies = paginate(sorted, currentPage, pageSize);\n\n    return { totalCount: filtered.length, data: movies };\n  };\n\n  render() {\n    const { length: count } = this.state.movies;\n    const { pageSize, currentPage, selectedGenre, sortColumn, searchQuery } =\n      this.state;\n    const { user } = this.props;\n\n    // if (count === 0) return <p>There are no movies to show</p>;\n\n    const { totalCount, data: movies } = this.getPagedData();\n    return (\n      <div className='row'>\n        <div className='col-2'>\n          <ListGroup\n            items={this.state.genres}\n            selectedItem={selectedGenre}\n            onItemSelect={this.handleGenreSelect}\n          />\n        </div>\n        <div className='col'>\n          {user && (\n            <Link\n              to='/movies/new'\n              className='btn btn-primary'\n              style={{ marginBottom: 20 }}\n            >\n              New Movie\n            </Link>\n          )}\n          <p>Showing {totalCount} movies in the databse</p>\n          <SearchBox value={searchQuery} onSearch={this.handleSearch} />\n          <MoviesTable\n            movies={movies}\n            sortColumn={sortColumn}\n            onLike={this.handleLike}\n            onDelete={this.handleDelete}\n            onSort={this.handleSort}\n          />\n          <Pagination\n            itemsCount={totalCount}\n            pageSize={pageSize}\n            currentPage={currentPage}\n            onPageChange={this.handlePageChange}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Movies;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}